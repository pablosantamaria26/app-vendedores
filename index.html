<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mercado Limpio Smart Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root { --font-main: 'Plus Jakarta Sans', sans-serif; }
        body { font-family: var(--font-main); -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
        
        /* Utils */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .animate-pulse-ring { animation: pulse-ring 2s infinite; }

        /* Transitions */
        .view-section {
            display: none; opacity: 0; transition: opacity 0.3s ease;
        }
        /* Clase auxiliar para mostrar vistas via JS tradicional si es necesario, 
           aunque tu app.js usa .hidden/remove('hidden') */
        .view-section.active {
            display: flex; opacity: 1;
        }
        
        /* Progress Ring */
        .progress-circle { transition: stroke-dashoffset 0.5s ease; transform: rotate(-90deg); transform-origin: 50% 50%; }
        
        /* Fix Input Chat Selectable */
        #ai-input { -webkit-user-select: text; user-select: text; }
    </style>
</head>

<body class="bg-slate-950 text-white h-screen w-screen overflow-hidden selection:bg-blue-500 selection:text-white transition-colors duration-500">

    <div id="loader" class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex flex-col items-center justify-center hidden">
        <div class="relative w-20 h-20">
            <div class="absolute inset-0 border-4 border-blue-500/20 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-transparent border-t-blue-500 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i data-lucide="loader-2" class="text-blue-500 animate-spin w-8 h-8"></i>
            </div>
        </div>
        <p class="mt-6 text-xs font-bold tracking-[0.3em] text-blue-400 animate-pulse uppercase">Sincronizando</p>
    </div>

    <section id="view-login" class="view-section hidden flex-col items-center justify-center h-full p-8 relative z-10 absolute inset-0 bg-slate-950">
        <div class="absolute inset-0 overflow-hidden pointer-events-none -z-10">
            <div class="absolute top-[-10%] right-[-10%] w-96 h-96 bg-blue-600/20 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-[-10%] left-[-10%] w-96 h-96 bg-cyan-600/10 rounded-full blur-[100px]"></div>
        </div>

        <div class="w-full max-w-sm text-center">
            <div class="mb-12 relative group">
                <div class="w-24 h-24 bg-gradient-to-tr from-blue-600 to-cyan-500 rounded-3xl mx-auto shadow-2xl shadow-blue-500/30 flex items-center justify-center mb-8 rotate-3 transition-transform duration-500 group-hover:rotate-6">
                    <i data-lucide="box" class="w-10 h-10 text-white stroke-[1.5]"></i>
                </div>
                <h1 class="text-4xl font-extrabold tracking-tight">MERCADO<span class="text-blue-500">LIMPIO</span></h1>
                <p class="text-sm font-medium opacity-50 mt-2 tracking-wide">LogÃ­stica Inteligente V10 Pro</p>
            </div>

            <div class="space-y-4">
                <div class="relative group">
                    <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 w-5 h-5 transition-colors group-focus-within:text-blue-500"></i>
                    <input id="login-user" type="text" placeholder="USUARIO" class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 font-bold outline-none focus:border-blue-500 focus:bg-white/10 transition-all uppercase placeholder:normal-case placeholder:text-slate-600 text-white">
                </div>
                <div class="relative group">
                    <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 w-5 h-5 transition-colors group-focus-within:text-blue-500"></i>
                    <input id="login-pass" type="password" inputmode="numeric" placeholder="PIN DE ACCESO" class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 font-bold outline-none focus:border-blue-500 focus:bg-white/10 transition-all tracking-widest placeholder:tracking-normal placeholder:text-slate-600 text-white">
                </div>
                <button id="btn-login" class="w-full bg-blue-600 hover:bg-blue-500 active:scale-95 text-white font-bold py-4 rounded-2xl shadow-xl shadow-blue-600/20 transition-all flex items-center justify-center gap-2 mt-6">
                    INGRESAR <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </section>

    <section id="view-dashboard" class="view-section hidden flex-col h-full relative absolute inset-0 bg-slate-950">
        <header id="dash-header" class="pt-12 pb-6 px-6 flex justify-between items-end sticky top-0 z-20 backdrop-blur-md border-b border-transparent transition-colors duration-300">
            <div>
                <p id="lbl-saludo" class="text-xs font-bold uppercase tracking-widest mb-1 opacity-80 text-blue-400">Hola...</p>
                <h1 class="text-3xl font-black leading-none tracking-tight">Mis Zonas</h1>
                <p id="header-date" class="text-xs font-medium mt-1 uppercase opacity-60">Cargando...</p>
            </div>
            <button id="btn-theme-toggle" class="w-10 h-10 rounded-full border border-current opacity-30 hover:opacity-100 flex items-center justify-center active:rotate-180 transition-all">
                <i data-lucide="palette" class="w-5 h-5"></i>
            </button>
        </header>

        <div class="flex-1 overflow-y-auto px-6 pb-32 no-scrollbar pt-4">
            <div id="ia-suggestion-box" class="hidden animate-fade-in-up mb-8">
                </div>

            <div class="flex items-center justify-between mb-4 mt-2">
                <p class="text-xs font-bold uppercase tracking-[0.2em] opacity-60">Todas las Zonas</p>
                <span class="text-[10px] px-2 py-1 rounded-md border border-current opacity-40 font-bold">Disp.</span>
            </div>

            <div id="zones-grid" class="grid grid-cols-2 gap-3"></div>
        </div>

        <div id="btn-start-container" class="fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent z-30 pointer-events-none transition-transform duration-300">
            <button id="btn-start-route" onclick="startRoute()" class="hidden pointer-events-auto w-full bg-blue-600 text-white font-bold py-4 rounded-2xl shadow-2xl active:scale-95 transition-all flex items-center justify-center gap-2">
                <i data-lucide="map" class="w-5 h-5"></i> <span id="btn-start-label">INICIAR RUTA</span>
            </button>
        </div>
    </section>

    <section id="view-route" class="view-section hidden flex-col h-full relative absolute inset-0 bg-slate-950">
        <div id="route-header" class="pt-10 px-4 pb-4 flex items-center justify-between z-30 border-b border-transparent backdrop-blur-sm transition-colors duration-300">
            <button onclick="switchView('view-dashboard')" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center active:scale-95 transition-transform">
                <i data-lucide="chevron-left" class="w-5 h-5"></i>
            </button>
            
            <div class="flex flex-col items-center">
                <div class="flex items-center gap-3">
                    <div class="relative w-9 h-9">
                        <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                            <circle cx="18" cy="18" r="16" fill="transparent" stroke="currentColor" stroke-width="3" class="opacity-10"></circle>
                            <circle id="progress-ring-circle" cx="18" cy="18" r="16" fill="transparent" stroke="#3b82f6" stroke-width="3" stroke-linecap="round" stroke-dasharray="100.5" stroke-dashoffset="100.5" class="progress-circle"></circle>
                        </svg>
                        <span id="progress-percent" class="hidden"></span>
                    </div>
                    <div>
                        <h2 class="text-sm font-black leading-none uppercase">Ruta Activa</h2>
                        <p id="route-count-lbl" class="text-[10px] font-bold opacity-60 mt-0.5 text-blue-400">0 / 0 Completados</p>
                    </div>
                </div>
            </div>
            
            <button id="fab-focus-mode" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center active:scale-95 transition-transform">
                <i data-lucide="maximize-2" class="w-4 h-4 opacity-70"></i>
            </button>
        </div>

        <div id="route-container" class="flex-1 overflow-y-auto px-4 pt-4 pb-32 no-scrollbar"></div>
        
    </section>

    <div id="modal-options" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-6 animate-fade-in-up">
        <div class="bg-slate-900 border border-white/10 w-full max-w-sm rounded-3xl p-6 shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
            
            <div class="flex justify-between items-start mb-6 relative z-10">
                <div>
                    <h3 id="modal-title" class="text-xl font-bold text-white leading-tight">Cliente</h3>
                    <p class="text-xs opacity-50 uppercase font-bold tracking-widest mt-1">Registrar Visita</p>
                </div>
                <button onclick="document.getElementById('modal-options').classList.add('hidden')" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/5 hover:bg-white/10 text-white/50">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4">
                <button onclick="saveVisit('Stock')" class="p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 text-xs font-bold text-white text-left active:scale-95 transition-all">
                    <div class="text-blue-400 mb-1"><i data-lucide="package" class="w-4 h-4"></i></div> TIENE STOCK
                </button>
                <button onclick="saveVisit('Dinero')" class="p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 text-xs font-bold text-white text-left active:scale-95 transition-all">
                    <div class="text-blue-400 mb-1"><i data-lucide="dollar-sign" class="w-4 h-4"></i></div> SIN DINERO
                </button>
                <button onclick="saveVisit('Cerrado')" class="p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 text-xs font-bold text-white text-left active:scale-95 transition-all">
                    <div class="text-blue-400 mb-1"><i data-lucide="lock" class="w-4 h-4"></i></div> CERRADO
                </button>
                <button onclick="saveVisit('Precio')" class="p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 text-xs font-bold text-white text-left active:scale-95 transition-all">
                    <div class="text-blue-400 mb-1"><i data-lucide="trending-up" class="w-4 h-4"></i></div> PRECIO ALTO
                </button>
            </div>

            <textarea id="input-visit-obs" placeholder="Nota o recordatorio..." class="w-full h-24 bg-black/20 border border-white/10 rounded-xl p-3 text-sm focus:border-blue-500 outline-none resize-none mb-4 text-white placeholder:text-white/20"></textarea>

            <button onclick="saveVisit('Nota General')" class="w-full bg-white text-slate-900 font-bold py-3.5 rounded-xl shadow-lg active:scale-95 transition-transform hover:bg-gray-100">
                GUARDAR NOTA
            </button>
        </div>
    </div>

    <div id="ai-panel" class="fixed inset-0 z-[70] bg-slate-900 translate-y-full transition-transform duration-300 flex flex-col">
        <div class="p-4 border-b border-white/10 flex justify-between items-center bg-white/5 backdrop-blur-md">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg shadow-purple-500/30">
                    <i data-lucide="sparkles" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <h3 class="font-bold text-white leading-none">Mercado Limpio IA</h3>
                    <p class="text-[10px] opacity-50 uppercase tracking-widest mt-1 text-white">Tu Copiloto de Ventas</p>
                </div>
            </div>
            <button onclick="toggleAI(false)" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center active:bg-white/10">
                <i data-lucide="chevron-down" class="w-5 h-5 text-white opacity-70"></i>
            </button>
        </div>

        <div id="chat-msgs" class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar bg-black/20">
            <div class="bg-white/5 border border-white/5 text-slate-200 p-4 rounded-2xl rounded-tl-none text-sm leading-relaxed max-w-[85%]">
                Hola ðŸ‘‹. Tengo acceso a tu historial, stock y patrones de zona. Â¿En quÃ© te ayudo hoy?
            </div>
        </div>

        <div class="p-4 bg-slate-900 border-t border-white/10 pb-8 safe-area-bottom">
            <div class="relative">
                <input id="ai-input" type="text" placeholder="Ej: Â¿QuÃ© le ofrezco al cliente #102?" class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-4 pr-14 text-sm focus:border-blue-500 outline-none shadow-inner text-white placeholder:text-white/30">
                <button onclick="handleAISend()" class="absolute right-2 top-2 bottom-2 w-10 bg-blue-600 hover:bg-blue-500 text-white rounded-xl flex items-center justify-center shadow-lg active:scale-90 transition-transform">
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>

    <button onclick="toggleAI(true)" class="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-tr from-purple-600 to-indigo-600 rounded-full shadow-lg shadow-indigo-500/40 flex items-center justify-center text-white z-40 active:scale-90 transition-transform hidden" id="fab-ai">
        <i data-lucide="sparkles" class="w-6 h-6"></i>
    </button>

    <script src="app.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar iconos
            if (window.lucide) {
                lucide.createIcons();
            }
            
            // Re-inicializar iconos cada vez que se actualiza el DOM dinÃ¡micamente
            // (Un pequeÃ±o hack para asegurar que los iconos nuevos en listas funcionen)
            const observer = new MutationObserver(() => {
                if (window.lucide) lucide.createIcons();
            });
            observer.observe(document.body, { childList: true, subtree: true });
            
            // Helpers visuales
            window.toggleAI = function(show) {
                const panel = document.getElementById('ai-panel');
                const input = document.getElementById('ai-input');
                if(show) {
                    panel.classList.remove('translate-y-full');
                    setTimeout(() => input.focus(), 300);
                } else {
                    panel.classList.add('translate-y-full');
                }
            };
        });
    </script>
</body>
</html>
